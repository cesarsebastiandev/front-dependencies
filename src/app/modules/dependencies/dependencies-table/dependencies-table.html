<!-- Show loading spinner while fetching data -->
@if (loading()) {
<app-spinner text="Cargando dependencias..." />
} @else if (error()) {
<!-- Show error message if an error occurred -->
<h1 class="show-text error">{{ error() }}</h1>
} @else if (dependencyData()?.length === 0) {
<!-- Show message when no dependencies exist -->
<div class="margin-btns">
  <button matButton (click)="openCreateDependency()">
    <mat-icon>add</mat-icon> Registrar Dependencia
  </button>
</div>
<h1 class="show-text">No hay dependencias</h1>
} @else {
<!-- Show table when dependencies exist -->

<!-- Create button -->
<div class="margin-btns">
  <button matButton (click)="openCreateDependency()">
    <mat-icon>add</mat-icon> Registrar Dependencia
  </button>
</div>

<!-- Search input -->
<div class="margin-searcher">
  <mat-form-field>
    <mat-label>Buscador</mat-label>
    <input
      matInput
      (keyup)="applyFilter($event)"
      placeholder="Ex. Desarrollo Integral de la Familia"
      #input
    />
  </mat-form-field>
</div>

<!-- Table section -->
<section class="example-container mat-elevation-z8" tabindex="0">
  <table mat-table [dataSource]="dataSource" matSort>
    <!-- ID Column -->
    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
      <td mat-cell *matCellDef="let row">{{ row.id }}</td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
      <td mat-cell *matCellDef="let row">{{ row.name }}</td>
    </ng-container>

    <!-- Address Column -->
    <ng-container matColumnDef="address">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Dirección</th>
      <td mat-cell *matCellDef="let row">{{ row.address }}</td>
    </ng-container>

    <!-- Telephone Column -->
    <ng-container matColumnDef="telephone">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Teléfono</th>
      <td mat-cell *matCellDef="let row">{{ row.telephone }}</td>
    </ng-container>

    <!-- Email Column -->
    <ng-container matColumnDef="email">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
      <td mat-cell *matCellDef="let row">{{ row.email }}</td>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="is_active">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Estatus</th>
      <td mat-cell *matCellDef="let row">
        <span
          [ngClass]="{
            'status-active': row.is_active,
            'status-inactive': !row.is_active
          }"
        >
          {{ row.is_active ? "Activo" : "Inactivo" }}
        </span>
      </td>
    </ng-container>

    <!-- Created At Column -->
    <ng-container matColumnDef="created_at">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        Fecha de creación
      </th>
      <td mat-cell *matCellDef="let row">{{ row.created_at }}</td>
    </ng-container>

    <!-- Updated At Column -->
    <ng-container matColumnDef="updated_at">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>
        Fecha de actualización
      </th>
      <td mat-cell *matCellDef="let row">{{ row.updated_at }}</td>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Acciones</th>
      <td mat-cell *matCellDef="let row">
        <div style="display: flex; justify-content: space-around; gap: 2px">
          <!-- Edit button (disabled if inactive) -->
          <button
            matIconButton
            matTooltip="Editar Dependencia"
            [disabled]="row.is_active === false"
            (click)="openEditDependency(row)"
          >
            <mat-icon>edit</mat-icon>
          </button>

          <!-- Toggle active/inactive -->
          <button
            matIconButton
            [matTooltip]="row.is_active === false ? 'Activar' : 'Desactivar'"
            (click)="openDeactivateDependency(row.id, row.is_active)"
          >
            <mat-icon>power_settings_new</mat-icon>
          </button>
        </div>
      </td>
    </ng-container>

    <!-- Table headers and rows -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

    <!-- No matching data row -->
    <tr class="mat-row" *matNoDataRow>
      <td class="mat-cell" colspan="4">
        No hay datos que coincidan con "{{ input.value }}"
      </td>
    </tr>
  </table>

  <!-- Pagination controls -->
  <mat-paginator
    [pageSize]="5"
    [pageSizeOptions]="[5, 10, 25, 100]"
    aria-label="Select page of items"
  ></mat-paginator>
</section>
}
